{{ if eq .chezmoi.osRelease.id "fedora" -}}
#!/bin/bash

echo "Adding Yum repository keys"
{{- range .packages.linux.fedoraRepositories.yum }}
sudo rpm --import {{ .gpgkey }}
{{- end }}

echo "Adding Yum repositories"
{{- range .packages.linux.fedoraRepositories.yum }}
if [ ! -f /etc/yum.repos.d/{{ .name }}.repo ]; then
  echo "Adding {{ .name }} repository"
  sudo sh -c 'echo -e "[{{ .name }}]\nname={{ .name }}\nbaseurl={{ .baseurl }}\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=\"{{ .gpgkey }}\"" > /etc/yum.repos.d/{{ .name }}.repo'
else
  echo "{{ .name }} repository already exists, skipping"
fi
{{- end }}

echo "Enabling COPR repositories"
{{- range .packages.linux.fedoraRepositories.copr }}
sudo dnf copr enable -y {{ . }}
{{- end }}

echo "Refreshing DNF metadata"
sudo dnf makecache

echo "Installing DNF packages"
sudo dnf install -y{{ range .packages.linux.fedora }} {{ . }}{{ end }}
{{ end -}}
